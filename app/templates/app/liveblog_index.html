{% extends "app/base.html" %}

{% block content %}
    <div class="container">
        <h1>hello</h1>
        <div class="row" id="post-list">
            {% for post in post_list %}
                {% include "app/partial/post.html" with post=post only %}
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block extra-body %}

    <script>
        const handlers = {
            ws: null,
            connect(ws_url) {
                this.ws = new WebSocket(ws_url);

                this.ws.onopen = this.onopen.bind(this);
                this.ws.onclose = this.onclose.bind(this);
                this.ws.onerror = this.onerror.bind(this);
                this.ws.onmessage = this.onmessage.bind(this);
            },
            onopen() {
                console.log("connected to websocket server")
            },
            onclose(event) {
                if (!event.wasClean) {
                    console.error("websocket server closed or error")
                }
            },
            onerror() {
                console.error("websocket server error")
            },
            onmessage(event) {
                const message_json = event.data;
                console.log("websocket text message received :", message_json)
            }
        }

        const ws_url = "ws://localhost:8000/ws/liveblog/";
        handlers.connect(ws_url);

    </script>

{% endblock %}